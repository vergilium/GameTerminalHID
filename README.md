===================================================================
|		GAME TERMINAL V2 (PIC18F2550)
|		Описание функционала
===================================================================
1. Введение
2. Основные функции
3. Переключение на плату
4. Режим консоли и клавиатуры
5. Программирование и удаление ключей
6. Обновление прошивки по USB
 
=======================================================================================

1. Введение.
	После длительной эксплуатации устройств на основе контроллера PIC18F2550
с первой версией прошивки были выявлены серьезные не доработки и неудобства в 
использовании. В связи с этим код контроллера был переписан на язык Си в 
среде программирования mikroC PRO for PIC с целью изменения алгоритма раоты и 
повышения качества работы устройства в целом. Основной целью проекта является: 
с помощью минимальных затрат(перепрограммированием контроллера) добится улучшение
работы устройства. Никаких дополнительных модификаций устройства не требуется.

=======================================================================================

2. В новом алгоритме сохранены основные функции первой версии прошивки и добавлены
новые. Основным отличием в работе является взаимодействия работы контроллера с 
компьютером. Новый алгоритм реализует виртуальную клавиатуру HID в системе ПК.
Т.е. данные принимаются с PC2 клавиатуры подключенной к терминалу и передаются 
через контроллер компьютеру по USB.

	Переделан алгоритм обработки клавиатуры PC2 подключенной к терминалу. 
Теперь кнопки обрабатываются как в оригинальной распайке автомата, т.е. нажал
кнопку, она зафиксировалась на плате, отпустил и на плате немедленно произошло
отпускание. При использовании такого метода стает возможным использование консоли
для ввода паролей на плате и в процессе игры кнопки реагируют на нажатия незамедлительно,
а не как в первой версии по таймеру из-за чего ввод пароля на плату выполнялось с 
использованием кнопок F1 - F10. Воод пароля этими кнопками не доступен в обновленной 
версии.

	Добавлены функции для работы контроллера со светодиодами клавиатуры, что позволяет 
выводить индикацию светодиодов с ПК и использовать индикацию для отображения режимов 
контроллера. В частности при переходе в режим записи пароля шифрования загорается 
светодиод Scroll Lock, а при сохранении светодиод гаснет. Еще добавлена функция инициализации
клавиатуры, что позволяет определять ее работоспособность и инициализировать если используется
клавиатура с сдоеным режимом PC2-USB. Ранее в некоторых моделях приходилось подключать клавиатуру
к ПК для ее инициализации, а только потом она работала в терминале.

	Добавлена возможность ввода пароля шифрования на ПК через кредитный ключ. Что
повышает безопасность, так как оператор не знает фактический пароль. Сам пароль
можно менять и удалять без перепрограммирования контроллера под средством ввода
с клавиатуры.
	Запись пароля в память контроллера выполняется после воода ключевой фразы "программированиеp" 
(где p - английская буква, от слова password). Затем контроллер пикнет и засветится светодиод ScrollLock. 
После этого можно вводить пароль. После ввода нужно нажать кнопку ENTER для записи его в память.
Если все сделано правильно и пароль сохранится контроллер пикнет и погасит светодиод ScrollLock.
	В случае нажатия кнопки ENTER не введя ни одного символа то загорятся и погаснут все светодиоды
клавиатуры и контроллер пикнет 2 раза. Это означает, что пароль не изменен и произойдет выход с режима
изменения пароля.
-----------------------------------ВАЖНО---------------------------------------------------
		В память записуются сканкоды кнопок и признак зажатой кнопки SHIFT. Конкретный 
	пароль зависит от выставленого языка в системе и не фиксируется кнопка CapsLock при 
	запоминании. Пароль может содержать кнопки букв и цифр основной клавиатуры. Клавиатура
	NUMPAD не используется. После записи пароля в память необходимо вывести его с помощью 
	контроллера в текстовый редактор и сверить во избежание ошибок.
-------------------------------------------------------------------------------------------
	Для стирания пароля с памяти МК необходимо ввести фразу "удалениеp" и звуковой сигнал
проиндицирует о стирании успешной операции.
	Для вывода пароля в ПК необходимо зажать кнопку левый Ctrl и поднести кредитный ключ (переключения
на плату не произойдет). После этого контроллер введет пароль и нажмет два раза кнопку ENTER.
Затем контроллер зависнет на 10 секунд. Это нужно для того, чтобы избежать повторных вводов и 
незапланированого перехода на плату. За это время оператор должен закрыть кредитный ключ иначе
произойдет переключение. 

	Добавлена возможность использования 11ти кнопок для платы. Эта функция опциональная,
устанвливается и снимается кодовыми фразами. Распределена на кнопку 6 клавиатуры и
F2 консоли.
---------------------------------------------------------------------------------------
	ВНИМАНИЕ. 
	11я кнопка на одной линии со светодиодом на плате. Если этот режим активирован
	то индикация перехода на плату и нажатия кнопок не работает. Включенный светодиод
	индицирует только о зажатой 11й кнопке.
--------------------------------------------------------------------------------------

	Присутствует возможность отключения функции USB в случае использования терминала без ПК.
Это ускооряет работу контроллера и уменьшает энергопотребление самого контроллера. Отключение 
выполняется фразой "удалениеu", а активация режима фразой "программированиеu". После ввода 
этих фраз произойдет запоминание настроек и перезагрузка контроллера.
------------------------------ВАЖНО----------------------------------------------------
	Режим включения/отключения USB не влияет на возможность обновление прошивки по USB.
---------------------------------------------------------------------------------------
----------------------------ВНИМАНИЕ---------------------------------------------------
		В текущей версии библиотеки USB есть нюанс в работе. На ПК с USB 3.0 после загрузки ОС
	устройство не определяется. До загрузки ОС такого не наблюдается. В BIOS, DOS и на USB 2.0
	эмуляция клавиатуры выполняется без каких либо погрешностей.
---------------------------------------------------------------------------------------

	Реализована возможность обновления прошивки по USB через загрузчик. Это позволяет обновить
версию микропрограммы контроллера не разбирая терминал, что ускоряет работу. Для перехода в этот 
режим нужно ввести вразу "программирование0", после чего контроллер перезагрузится и в 
течении 10сек будет ожидать подключения загрузчика (программы bootloader). Если за это время
подключение не произошло то контроллер запустится в обычном режиме. Также после обновления
микропрограммы контроллер перезагрузится и начнет выполнение новой программы.
	Если по каким либо причинам возникли ошибки при программировани и нет возможности
перейти в режим обновления с клавиатуры, нужно выключить терминал, разобрать и замкнуть
ножки 18 и 19 контроллера, и в таком положении подать питание. Контроллер сразу запустится
в режиме обновления после чего можно обновить микропрограмму.

	Добавлена возможность работы с консолью MСЛ PC2 разьемом. Консоль - это та же клавиатура
только распаяна на кнопки F1 - F12. В режим консоли можно перейти зажав СТОП1 на консоли и 
не отпускать до звукового сигнала. Переход на клавиатуру производится зажатием кнопки ENTER
на цифровой клавиатуре до сигнала. В режиме ПК кнопки консоли преобразуются в коды
соответствующие кнопкам используемые в онлайн серверах, что позволяет использование консоли
и для онлайн также.

-------------------------------ВАЖНО---------------------------------------------------
---------------------------------------------------------------------------------------
Все настройки контроллера выполняются исключетльно в режиме платы.
Настройки: "режим прошивки", "отключение/включение USB" сопровождаются перезапуском
контроллреа и выходом в режим ПК.
---------------------------------------------------------------------------------------
	
==========================================================================================	
	
	
